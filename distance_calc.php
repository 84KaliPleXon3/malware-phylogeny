#!/usr/bin/env php
<?php

	$string_lengths = array();
	$filenames = array();
	$names = array();
	$strings = array();

	array_shift($argv);
	$a = array_chunk($argv, 2);
	$max = count($a);

	for ($i = 0; $i < $max; ++$i) {
		$filenames[$i] = $a[$i][0];
		$names[$i] = $a[$i][1];
		$strings[$i] = file_get_contents($filenames[$i]);
	}

	$comma = '';
	for ($i = 0; $i < $max; ++$i) {
		printf("$comma\"%s\"", $names[$i]);
		$comma = ',';
	}
	echo "\n";

	for ($i = 0; $i < $max; ++$i) {
		$comma = '';
		for ($j = 0; $j < $max; ++$j) {
			if ($j >= $i) {
				$d = NCD($strings[$i], $strings[$j]);
				printf("$comma%.4f", $d);
			} else
				print($comma);
			$comma = ',';
		}
		echo "\n";
	}

exit;


function NCD($stringX, $stringY)
{
	global $string_lengths;

	if (array_key_exists($stringX, $string_lengths))
		$Zx = $string_lengths[$stringX];
	else {
		$Zx = strlen(bzcompress($stringX));
		$string_lengths[$stringX] = $Zx;
	}

	if (array_key_exists($stringY, $string_lengths))
		$Zy = $string_lengths[$stringY];
	else {
		$Zy = strlen(bzcompress($stringY));
		$string_lengths[$stringY] = $Zy;
	}

	$Zxy = strlen(bzcompress($stringX.$stringY));
	$Zyx = strlen(bzcompress($stringY.$stringX));

	$e1 = max($Zxy - $Zx, $Zyx - $Zy)/max($Zx, $Zy);
	
	return $e1;
}
