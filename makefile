all: wso_phylogeny.png phy.png

phy.png: distance_matrix.csv neighbor_joining/nj.php
	php neighbor_joining/nj.php distance_matrix.csv phy.png lfiscanner

distance_matrix.csv: distance_calc.php
	./distance_calc.php  \
		exemplars/2.0  2.0 \
		exemplars/2.1 2.1 \
		exemplars/2.2 2.2 \
		exemplars/2.3 2.3 \
		exemplars/2.4 2.4 \
		exemplars/2.5 2.5 \
		exemplars/2.5.1 2.5.1\
		exemplars/2.6 2.6 \
		exemplars/2.7 2.7 \
		exemplars/2.8 2.8 \
		exemplars/2.9 2.9 \
		exemplars/3.0 3.0 \
		exemplars/3.1 3.1 \
		exemplars/4.1.1 4.1.1 \
		exemplars/bogel bogel \
		exemplars/fx29 fx29 \
		exemplars/lfiscanner.php lfiscanner \
		exemplars/waw waw \
		> distance_matrix.csv

traits.csv: find_traits
	./find_traits > traits.csv

nj_phylogeny.png: distance_matrix.csv neighbor_joining/nj.php
	php neighbor_joining/nj.php distance_matrix.csv nj_phylogeny.png lfiscanner 750 500

wso_phylogeny.png: phylogeny/p2.php traits.csv
	phylogeny/p2.php traits.csv > traits.dot
	dot -Tpng -o wso_phylogeny.png traits.dot

clean:
	-rm -rf distance_matrix.csv phy.png traits.csv traits.dot
	-rm -rf shellbot_distance_matrix.csv shellbot_traits.csv 
	-rm -rf shellbot_traits.dot

shellbotphylogeny.png: shellbot_traits.csv
	phylogeny/p2.php shellbot_traits.csv > shellbot_traits.dot
	dot -Tpng -o shellbotphylogeny.png shellbot_traits.dot

shellbot_traits.csv: ./find_shellbot_traits
	./find_shellbot_traits > shellbot_traits.csv

shellbot_distance_matrix.csv: distance_calc.php
	# Hiding a shell script in a makefile - tsk tsk.
	DBLS=""; \
	for NAME in linuxnet/*; do \
		S=$$(basename $$NAME); \
		DBLS="$$DBLS $$NAME $$S"; \
	done; \
	./distance_calc.php $$DBLS  > shellbot_distance_matrix.csv

shellbot_phylogeny.png: shellbot_distance_matrix.csv neighbor_joining/nj.php
	php neighbor_joining/nj.php \
		shellbot_distance_matrix.csv shellbot_phylogeny.png v0.1 750 750 > /dev/null


