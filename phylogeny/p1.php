#!/usr/bin/env php
<?php
include("Species.php");


list($species_names, $traits) = read_traits($argv[1]);

$species_array = array();
foreach ($species_names as $idx => $name) {
	$trait_list = array();
	$trait_indicators = $traits[$idx];
	foreach ($trait_indicators as $i => $v) {
		if ($v == 1)
			$trait_list[] = $i;
	}
	$new_species = new Species($name, $trait_list);
	$species_array[] = $new_species;
}

if (usort($species_array, 'cmp_species_objects') === FALSE) {
	echo "Problem with sort\n";
	exit;
}

print("Sorted species array:\n");
foreach ($species_array as $species) {
	print("Species named {$species->name} has {$species->trait_count} traits\n");
	$comma = '';
	foreach ($species->trait_list as $trait_number) {
		print($comma.$trait_number);
		$comma = ', ';
	}
	print("\n\n");
}

exit;

function read_traits($filename)
{
	$taxa_names = array();
	$M = array();
	$csv_handle = fopen($filename, "r");
	if ($csv_handle !== FALSE) {
		while (FALSE !== ($in = fgetcsv($csv_handle))) {
			if (substr($in[0], 0, 1) == '#') continue;
			$taxa_names[] = array_shift($in);
			$M[] = $in;

		}
	} else {
		print("Problem opening \"$filename\" for read\n");
		exit;
	}
	return array($taxa_names, $M);
}
