# An algorithm to calculate malware phylogeny, an example and counterexample

Source code malware can easily be had by googling or running a wordpress
honey pot. Much of it is interpreted languages, like PHP or Perl.

##Source code malware evolution

Ordinary biological evolution analogies are ill-suited to guessing
at malware phylogeny. Biological phylogenies assume binary splits,
malware splits many times. Biological phylogenies assume a single
common ancestor. Malware often, maybe almost always, has more than
a single ancestor.

Evolution by feature addition.  Phone home or backdoor. Code transplant
from somewhere else.

##Neighbor Joining


###Normalized Compression Distance

NCD algorithm from [Common Pitfalls Using The Normalized Compression Distance](http://www.ims.cuhk.edu.hk/~cis/2005.4/01.pdf)
it seems to give closer-to-zero "distance" of a piece of code to itself.

Put Neighbor Joining image here

Discussion of obvious wrongness of phylogeny done this way. Close, but no cigar.

##Algorithm

###Determine Features

###Description

1. order species by decreasing size of feature list in an array
2. Remove species with largest feature list from  array
3. Compare current feature list to other species in order from next largest feature list to smallest
4. When the other species has a feature list that's a strict subset of current feature list,
   assign current species as child of other species
5. Mark all traits of the current species common to the new parent.
6. If more than one trait is unmarked, repeat from (3)
7. If no more than one trait is unmarked, go to one.
8. If you have compared traits of the current species to all species
   and still have more than one unmarked traits, add the current species
   to the set of root species.

###Performance

Always terminates. Every species gets popped off ordered list of species.

####Worst case 
One root, many children, no grandchildren. All children have a lot of common traits,
one trait differentiating.  Worst case O(n^2) for comparison of traits.

##Example: Web Shell by oRb

###Description

Phylogeny image here

##Counter example: Perl IRC bot
